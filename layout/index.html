<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Heartbeat</title>
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="bootstrap.css" rel="stylesheet">
    <link href="heartbeat.css" rel="stylesheet">
    
    <!-- Le Less -->
    <link rel="stylesheet/less" type="text/css" href="heartbeat.less">
    <script src="js/less.js" type="text/javascript"></script>
    
    <!-- Le javascript -->
    <!-- placed up here so that the inline demos can be next to their markup -->
    <script src="http://code.jquery.com/jquery-1.7.js"></script>
    <script type="text/javascript" src="selftest/jquery.sha256.js"></script>
    <script type="text/javascript" src="selftest/jquery.cookie.js"></script>
    <script type="text/javascript" src="selftest/async.js"></script>
    <!-- <script src="js/bootstrap-transition.js"></script> -->
    <!-- <script src="js/bootstrap-alert.js"></script> -->
    <!-- <script src="js/bootstrap-modal.js"></script> -->
    <!-- <script src="js/bootstrap-dropdown.js"></script> -->
    <!-- <script src="js/bootstrap-scrollspy.js"></script> -->
    <!-- <script src="js/bootstrap-tab.js"></script> -->

    <!-- <script src="js/bootstrap-twipsy.js"></script> -->
    <!-- <script src="js/bootstrap-popover.js"></script> -->
    <!-- <script src="js/bootstrap-button.js"></script> -->
    <script src="js/bootstrap-collapse.js"></script>
    <script type="text/javascript"
        src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>

    <script type="text/javascript">
      var map;
      var myLatlng = new google.maps.LatLng(52.524268, 13.40629);

      function initialize() {
        var myOptions = {
          zoom: 5,
          center: myLatlng,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        map = new google.maps.Map(document.getElementById('map_canvas'),
            myOptions);
            
        var marker = new google.maps.Marker({
          position: myLatlng, 
          map: map
        });     
      }
    </script>



    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  </head>

  <body  onload="initialize()">

    <div class="navbar">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="#">Heartbeat</a>
          <ul class="nav">
            <li class="active"><a href="#">Home</a></li>
            <li><a href="#login">Login</a></li>
            <li><a href="#about">About</a></li>
            <li><a href="#contact">Contact</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container">

      <header class="page-header">
        <h1><span class="green"></span>Sebastian Aktivist</h1>
      </header>
      
      <h2 data-toggle="collapse" data-target="#mail"><span class="green"></span>Mail</h2>
      <div id="mail" class="collapse">
        <div class="update">
          <h3>letzter Update</h3>
          <table class="striped-table">
            <thead>
                <tr>
                <th>Datum</th>
                <th>Zeit</th>
                <th>Ort</th>
                <th>Nachricht</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>03.11.2011</td>
                <td>15:12 Uhr</td>
                <td>Berlin</td>
                <td>alles fein</td>
              </tr>
              <tr>
                <td>02.11.2011</td>
                <td>08:42 Uhr</td>
                <td>Berlin</td>
                <td>gut angekommen</td>
              </tr>
              <tr>
                <td>01.11.2011</td>
                <td>20:51 Uhr</td>
                <td>London</td>
                <td>fliege gleich nach Belrin</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <h2 data-toggle="collapse" data-target="#twitter"><span class="yellow"></span>Twitter</h2>
      <div id="twitter" class="collapse">
        <div class="update">
          <h3>letzter Update</h3>
          <table class="striped-table">
            <thead>
                <tr>
                <th>Datum</th>
                <th>Zeit</th>
                <th>Ort</th>
                <th>Nachricht</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>03.11.2011</td>
                <td>15:12 Uhr</td>
                <td>Berlin</td>
                <td>alles fein</td>
              </tr>
              <tr>
                <td>02.11.2011</td>
                <td>08:42 Uhr</td>
                <td>Berlin</td>
                <td>gut angekommen</td>
              </tr>
              <tr>
                <td>01.11.2011</td>
                <td>20:51 Uhr</td>
                <td>London</td>
                <td>fliege gleich nach Belrin</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <script>
        var notifications;
        function register(){ 
          var session, salt;
          async.series([
          function(callback){
            console.log("getting session");
            //session = $.cookie("session");
            if(session){
              callback();
            }else{
              $.getJSON('/session', function(data){
                session = data.id;
                salt = data.salt;
                $.cookie("session", session);
                console.log("session id: "+session+" global salt: "+salt);
                callback();
              });
            }
          },
          /*function(callback){
            console.log("register");
            $.post('/register', {id: session, username: "jaseg", pwhash: $.sha256("foo"+salt)}, function(data){
              console.log(data);
              callback();
            });
          },*/
          function(callback){
            console.log("login");
            $.post('/login', {id: session, username: "jaseg", pwhash: $.sha256("foo"+salt)}, function(data){
              console.log(data);
              callback();
            });
          },
          /*function(callback){
            console.log("notification");
            $.post('/notification', {id: session}, function(data){
              console.log(data);
              callback();
            });
          },*/
          function(callback){
            console.log("list notifications");
            $.getJSON('/notifications/by-source/extern', {id: session}, function(data){
              notifications = data;
              callback();
            });
          },
          function(callback){
            var str='';
            for(var i=0; i<notifications.length; i++){
                  var nf = notifications[i];
                  str += '<tr>';
                  str += '<td>';
                  str += nf.notification.timestamp;
                  str += '</td>';
                  str += '<td>';
                  if(nf.notification.coordinates.latitude != 0 || nf.notification.coordinates.longitude){
                  str += nf.notification.coordinates.latitude;
                  str += ' ';
                  str += nf.notification.coordinates.longitude;
                  }
                  str += '</td>';
                  str += '<td>';
                  str += nf.notification.content?nf.notification.content:'';
                  str += '</td>';
                  str += '</tr>';
              }
              $("#space").html(str);
          }
          ]);
        }
        register();
      </script>
      <h2 data-toggle="collapse" data-target="#web"><span class="red"></span>Mobile</h2>
      <div id="web" class="collapse">
        <div class="update">
          <h3>letzter Update</h3>
          <table class="striped-table">
            <thead>
                <tr>
                <th>Datum</th>
                <th>Zeit</th>
                <th>Ort</th>
                <th>Nachricht</th>
              </tr>
            </thead>
            <tbody id='space'>
            </tbody>
          </table>
        </div>
      </div>

      <h2 data-toggle="collapse" data-target="#map_canvas">letzte Koordinaten (03.11.2011 - 17:54 Uhr)</h2>
      <div id="map_canvas"></div>
      

      <footer>
        <p>&copy; Heartbeat 2011</p>
      </footer>

    </div> <!-- /container -->

  </body>
</html>
